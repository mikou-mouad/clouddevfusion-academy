<div class="testimonials-page">
  <!-- Hero Section -->
  <section class="testimonials-hero">
    <div class="container">
      <h1>Témoignages</h1>
      <p class="hero-subtitle">Découvrez ce que nos étudiants et clients disent de nos formations</p>
    </div>
  </section>

  <!-- Témoignages écrits -->
  <section class="testimonials-section">
    <div class="container">
      <div class="section-header">
        <h2>Avis de nos étudiants</h2>
        <p class="section-subtitle">Plus de 95% de satisfaction</p>
      </div>
      
      <div class="loading-state" *ngIf="loading">
        <p>Chargement des témoignages...</p>
      </div>

      <div class="error-state" *ngIf="error && testimonials.length === 0">
        <p>{{ error }}</p>
      </div>

      <div class="testimonials-grid" *ngIf="!loading || displayedTestimonials.length > 0">
        <div class="testimonial-card" *ngFor="let testimonial of displayedTestimonials">
          <div class="testimonial-card-inner" *ngIf="testimonial && (testimonial.quote || testimonial.videoUrl)">
            <!-- Vidéo si disponible -->
            <div class="testimonial-video-container" *ngIf="testimonial.videoUrl">
              <!-- Vidéo uploadée (fichier local) -->
              <div class="video-wrapper" *ngIf="isUploadedVideo(testimonial.videoUrl)">
                <video controls [src]="testimonial.videoUrl" class="uploaded-video">
                  Votre navigateur ne supporte pas la lecture de vidéos.
                </video>
              </div>
              <!-- Vidéo externe (YouTube, Vimeo, etc.) -->
              <div class="video-wrapper" *ngIf="!isUploadedVideo(testimonial.videoUrl) && isVideoUrl(testimonial.videoUrl)">
                <iframe 
                  [src]="getVideoEmbedUrl(testimonial.videoUrl) | safe" 
                  frameborder="0" 
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                  allowfullscreen
                  loading="lazy">
                </iframe>
              </div>
            </div>
            
            <div class="testimonial-header">
              <div class="quote-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <path d="M3 21c3-3.6 5.4-6 9-6s6 2.4 6 6v1H3v-1z" fill="currentColor" opacity="0.1"/>
                  <path d="M6 8c0-1.1.9-2 2-2s2 .9 2 2v4c0 1.1-.9 2-2 2H7c-.6 0-1-.4-1-1V8z" fill="currentColor" opacity="0.2"/>
                  <path d="M14 8c0-1.1.9-2 2-2s2 .9 2 2v4c0 1.1-.9 2-2 2h-1c-.6 0-1-.4-1-1V8z" fill="currentColor" opacity="0.2"/>
                </svg>
              </div>
              <div class="testimonial-rating">
                <svg *ngFor="let star of [1,2,3,4,5]" width="18" height="18" viewBox="0 0 24 24" [attr.fill]="star <= (testimonial?.rating || 5) ? 'currentColor' : 'none'" fill="currentColor" stroke="currentColor" stroke-width="1">
                  <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                </svg>
              </div>
            </div>
            
            <p class="testimonial-quote" *ngIf="testimonial?.quote">{{ testimonial.quote }}</p>
            
            <div class="testimonial-author" *ngIf="testimonial?.author">
              <div class="author-avatar">
                <div class="avatar-initial">{{ testimonial.author.charAt(0) || '?' }}</div>
              </div>
              <div class="author-info">
                <h4 class="author-name">{{ testimonial.author }}</h4>
                <p class="author-role" *ngIf="testimonial.role">{{ testimonial.role }}</p>
                <p class="author-company" *ngIf="testimonial.company">{{ testimonial.company }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Pagination -->
      <div class="pagination-container" *ngIf="testimonials.length > itemsPerPage && !loading">
        <div class="pagination-info">
          <span>Page {{ currentPage }} sur {{ totalPages }} ({{ testimonials.length }} témoignage{{ testimonials.length > 1 ? 's' : '' }})</span>
        </div>
        <div class="pagination-controls">
          <button 
            class="pagination-btn" 
            (click)="previousPage()" 
            [disabled]="currentPage === 1"
            [attr.aria-label]="'Page précédente'">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"/>
            </svg>
          </button>
          
          <div class="pagination-numbers">
            <button 
              *ngFor="let page of getPageNumbers()" 
              class="pagination-number"
              [class.active]="page === currentPage"
              (click)="goToPage(page)">
              {{ page }}
            </button>
          </div>
          
          <button 
            class="pagination-btn" 
            (click)="nextPage()" 
            [disabled]="currentPage === totalPages"
            [attr.aria-label]="'Page suivante'">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Témoignages vidéo -->
  <section class="video-section" *ngIf="testimonialsWithVideos.length > 0">
    <div class="container">
      <div class="section-header">
        <h2>Témoignages vidéo</h2>
        <p class="section-subtitle">Écoutez nos étudiants partager leur expérience</p>
      </div>
      
      <div class="video-grid">
        <div class="video-testimonial-card" *ngFor="let testimonial of testimonialsWithVideos">
          <!-- Vidéo uploadée -->
          <div class="video-wrapper" *ngIf="isUploadedVideo(testimonial.videoUrl)">
            <video controls [src]="testimonial.videoUrl" class="uploaded-video">
              Votre navigateur ne supporte pas la lecture de vidéos.
            </video>
          </div>
          <!-- Vidéo externe -->
          <div class="video-wrapper" *ngIf="!isUploadedVideo(testimonial.videoUrl)">
            <iframe 
              [src]="getVideoEmbedUrl(testimonial.videoUrl!) | safe" 
              frameborder="0" 
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
              allowfullscreen
              loading="lazy">
            </iframe>
          </div>
          <div class="video-testimonial-info">
            <div class="testimonial-rating">
              <svg *ngFor="let star of [1,2,3,4,5]" width="16" height="16" viewBox="0 0 24 24" [attr.fill]="star <= (testimonial?.rating || 5) ? 'currentColor' : 'none'" fill="currentColor" stroke="currentColor" stroke-width="1">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
              </svg>
            </div>
            <p class="video-testimonial-quote" *ngIf="testimonial.quote">"{{ testimonial.quote }}"</p>
            <div class="video-testimonial-author" *ngIf="testimonial.author">
              <strong>{{ testimonial.author }}</strong>
              <span *ngIf="testimonial.role || testimonial.company">
                <span *ngIf="testimonial.role">{{ testimonial.role }}</span>
                <span *ngIf="testimonial.role && testimonial.company">, </span>
                <span *ngIf="testimonial.company">{{ testimonial.company }}</span>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="cta-section">
    <div class="container">
      <div class="cta-content">
        <h2>Rejoignez nos étudiants satisfaits</h2>
        <p class="cta-subtitle">Démarrez votre parcours de certification Azure dès aujourd'hui</p>
        <div class="cta-actions">
          <a routerLink="/contact" class="btn btn-primary btn-large">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
            </svg>
            Prendre rendez-vous
          </a>
          <a routerLink="/registration" class="btn btn-secondary btn-large">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
              <circle cx="8.5" cy="7" r="4"/>
              <path d="M20 8v6M23 11h-6"/>
            </svg>
            S'inscrire avec le CPF
          </a>
        </div>
      </div>
    </div>
  </section>
</div>

