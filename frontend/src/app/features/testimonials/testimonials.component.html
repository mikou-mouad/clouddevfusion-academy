<div class="testimonials-page">
  <!-- Hero Section -->
  <section class="testimonials-hero">
    <div class="container">
      <h1>Témoignages</h1>
      <p class="hero-subtitle">Découvrez ce que nos étudiants et clients disent de nos formations</p>
    </div>
  </section>

  <!-- Témoignages écrits -->
  <section class="testimonials-section">
    <div class="container">
      <div class="section-header">
        <h2>Avis de nos étudiants</h2>
        <p class="section-subtitle">Plus de 95% de satisfaction</p>
      </div>

      @if (loading) {
        <div class="loading-state">
          <p>Chargement des témoignages...</p>
        </div>
      }

      @if (error && testimonials.length === 0) {
        <div class="error-state">
          <p>{{ error }}</p>
        </div>
      }

      @if (!loading || displayedTestimonials.length > 0) {
        <div class="testimonials-grid">
          @for (testimonial of displayedTestimonials; track testimonial) {
            <div class="testimonial-card">
              @if (testimonial && (testimonial.quote || testimonial.videoUrl)) {
                <div class="testimonial-card-inner">
                  <!-- Vidéo si disponible -->
                  @if (testimonial.videoUrl) {
                    <div class="testimonial-video-container">
                      <!-- Vidéo uploadée (fichier local) -->
                      @if (isUploadedVideo(testimonial.videoUrl)) {
                        <div class="video-wrapper">
                          <video controls [src]="testimonial.videoUrl" class="uploaded-video">
                            Votre navigateur ne supporte pas la lecture de vidéos.
                          </video>
                        </div>
                      }
                      <!-- Vidéo externe (YouTube, Vimeo, etc.) -->
                      @if (!isUploadedVideo(testimonial.videoUrl) && isVideoUrl(testimonial.videoUrl)) {
                        <div class="video-wrapper">
                          <iframe
                            [src]="getVideoEmbedUrl(testimonial.videoUrl) | safe"
                            frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen
                            loading="lazy">
                          </iframe>
                        </div>
                      }
                    </div>
                  }
                  <div class="testimonial-header">
                    <div class="quote-icon">
                      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M3 21c3-3.6 5.4-6 9-6s6 2.4 6 6v1H3v-1z" fill="currentColor" opacity="0.1"/>
                        <path d="M6 8c0-1.1.9-2 2-2s2 .9 2 2v4c0 1.1-.9 2-2 2H7c-.6 0-1-.4-1-1V8z" fill="currentColor" opacity="0.2"/>
                        <path d="M14 8c0-1.1.9-2 2-2s2 .9 2 2v4c0 1.1-.9 2-2 2h-1c-.6 0-1-.4-1-1V8z" fill="currentColor" opacity="0.2"/>
                      </svg>
                    </div>
                    <div class="testimonial-rating">
                      @for (star of [1,2,3,4,5]; track star) {
                        <svg width="18" height="18" viewBox="0 0 24 24" [attr.fill]="star <= (testimonial?.rating || 5) ? 'currentColor' : 'none'" fill="currentColor" stroke="currentColor" stroke-width="1">
                          <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                        </svg>
                      }
                    </div>
                  </div>
                  @if (testimonial?.quote) {
                    <p class="testimonial-quote">{{ testimonial.quote }}</p>
                  }
                  @if (testimonial?.author) {
                    <div class="testimonial-author">
                      <div class="author-avatar">
                        <div class="avatar-initial">{{ testimonial.author?.charAt(0) || '?' }}</div>
                      </div>
                      <div class="author-info">
                        <h4 class="author-name">{{ testimonial.author }}</h4>
                        @if (testimonial.role) {
                          <p class="author-role">{{ testimonial.role }}</p>
                        }
                        @if (testimonial.company) {
                          <p class="author-company">{{ testimonial.company }}</p>
                        }
                      </div>
                    </div>
                  }
                </div>
              }
            </div>
          }
        </div>
      }

      <!-- Pagination -->
      @if (testimonials.length > itemsPerPage && !loading) {
        <div class="pagination-container">
          <div class="pagination-info">
            <span>Page {{ currentPage }} sur {{ totalPages }} ({{ testimonials.length }} témoignage{{ testimonials.length > 1 ? 's' : '' }})</span>
          </div>
          <div class="pagination-controls">
            <button
              class="pagination-btn"
              (click)="previousPage()"
              [disabled]="currentPage === 1"
              [attr.aria-label]="'Page précédente'">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 18 9 12 15 6"/>
              </svg>
            </button>
            <div class="pagination-numbers">
              @for (page of getPageNumbers(); track page) {
                <button
                  class="pagination-number"
                  [class.active]="page === currentPage"
                  (click)="goToPage(page)">
                  {{ page }}
                </button>
              }
            </div>
            <button
              class="pagination-btn"
              (click)="nextPage()"
              [disabled]="currentPage === totalPages"
              [attr.aria-label]="'Page suivante'">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"/>
              </svg>
            </button>
          </div>
        </div>
      }
    </div>
  </section>

  <!-- Témoignages vidéo -->
  @if (testimonialsWithVideos.length > 0) {
    <section class="video-section">
      <div class="container">
        <div class="section-header">
          <h2>Témoignages vidéo</h2>
          <p class="section-subtitle">Écoutez nos étudiants partager leur expérience</p>
        </div>
        <div class="video-grid">
          @for (testimonial of testimonialsWithVideos; track testimonial) {
            <div class="video-testimonial-card">
              <!-- Vidéo uploadée -->
              @if (isUploadedVideo(testimonial.videoUrl)) {
                <div class="video-wrapper">
                  <video controls [src]="testimonial.videoUrl" class="uploaded-video">
                    Votre navigateur ne supporte pas la lecture de vidéos.
                  </video>
                </div>
              }
              <!-- Vidéo externe -->
              @if (!isUploadedVideo(testimonial.videoUrl)) {
                <div class="video-wrapper">
                  <iframe
                    [src]="getVideoEmbedUrl(testimonial.videoUrl!) | safe"
                    frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen
                    loading="lazy">
                  </iframe>
                </div>
              }
              <div class="video-testimonial-info">
                <div class="testimonial-rating">
                  @for (star of [1,2,3,4,5]; track star) {
                    <svg width="16" height="16" viewBox="0 0 24 24" [attr.fill]="star <= (testimonial?.rating || 5) ? 'currentColor' : 'none'" fill="currentColor" stroke="currentColor" stroke-width="1">
                      <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                    </svg>
                  }
                </div>
                @if (testimonial.quote) {
                  <p class="video-testimonial-quote">"{{ testimonial.quote }}"</p>
                }
                @if (testimonial.author) {
                  <div class="video-testimonial-author">
                    <strong>{{ testimonial.author }}</strong>
                    @if (testimonial.role || testimonial.company) {
                      <span>
                        @if (testimonial.role) {
                          <span>{{ testimonial.role }}</span>
                        }
                        @if (testimonial.role && testimonial.company) {
                          <span>, </span>
                        }
                        @if (testimonial.company) {
                          <span>{{ testimonial.company }}</span>
                        }
                      </span>
                    }
                  </div>
                }
              </div>
            </div>
          }
        </div>
      </div>
    </section>
  }

  <!-- CTA Section -->
  <section class="cta-section">
    <div class="container">
      <div class="cta-content">
        <h2>Rejoignez nos étudiants satisfaits</h2>
        <p class="cta-subtitle">Démarrez votre parcours de certification Azure dès aujourd'hui</p>
        <div class="cta-actions">
          <a routerLink="/contact" class="btn btn-primary btn-large">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
            </svg>
            Prendre rendez-vous
          </a>
          <a routerLink="/registration" class="btn btn-secondary btn-large">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
              <circle cx="8.5" cy="7" r="4"/>
              <path d="M20 8v6M23 11h-6"/>
            </svg>
            S'inscrire avec le CPF
          </a>
        </div>
      </div>
    </div>
  </section>
</div>

